<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <!--bootstrapでは実装が困難なときのためのcssファイル-->
  <link rel="stylesheet" href="/blackjack.css">

  <title>Playing Game</title>
  <script>
    let update_card;

    function waitScreen() {
      let waitScreen = document.getElementById("wait_screen");
      let button = document.getElementById("disableButton");
      waitScreen.classList.add("disable");
    }

    window.onload = function () {

      var sse = new EventSource('/blackjack/status/' + [[${ room_id }]]);
      sse.onmessage = function (event) {
        room = JSON.parse(event.data);
        console.log(room);
        let members = room[0].members;
        console.log(members);
        let dealer = members[0];
        members.forEach(function (key) {
          console.log(key);
        });
        console.log(members);
        document.getElementById("p1").textContent = event.data;
        //document.getElementById("player_card").innerHTML = "<img src='/tramp/" + members[1].deals[0].id + ".jpg'/> ";




      }
    }
    waitScreen();
  </script>
</head>

<body>
  <div id="wait_screen">

    <p class="text-center">メンバーが集まるのを待っています</p>
    <input id="disableButton" type="button" onclick="waitScreen();" value="非表示" />
  </div>

  <div id="p1"></div>
  <div>
    <p><a th:href="@{/exit/{id}(id=${room_id})}" class="btn btn-sm btn-dark button" role="button">退室</a></p>
  </div>
  <div th:if=${room_id}>
    <h1 class="text-center welcome">ルーム[[${room_id}]]へようこそ！！</h1>
  </div>

  <div class="text-center" th:if="${bet}">
    賭けたチップ:[[${bet}]]<br>
    <a th:href="@{/blackjack/{rid}/start(rid=${room_id})}" class="btn btn-sm btn-dark marbutton" role="button">START</a>
  </div>


  <div class="text-center" th:if="${cards}">
    <h2 class="player">プレイヤーの手札</h2>
    <div id="player_card" th:each="card,stat:${cards}">
      <img height="100px" th:src="@{${'/tramp/' + card.id + '.jpg'}}" alt="" />
    </div>
    <div>
      合計:[[${total}]]
    </div>
    <!--スタンド時にボタンが非表示に-->
    <div th:unless="${stand_flag}">

      <!--Hit_Z0413-->
      <form action="hit" method="get">
        <input type="submit" value="ヒット">
      </form>

      <form action="stand" method="get">
        <input type="submit" value="スタンド">
      </form>
    </div>
    <div th:if="${stand_flag}">
      スタンドしました
    </div>
  </div>

  <div class="text-center" th:if="${dCards}">
    <h2 class="dealer">ディーラーの手札</h2>
    <div th:each="card,stat:${dCards}">
      <p th:if="${stand_flag == true || stat.count gt 1}">
        <img height="100px" th:src="@{${'/tramp/' + card.id + '.jpg'}}" alt="" />
      <p th:if="${stand_flag == false && stat.first}">
        <img height="100px" src="/tramp/53.jpg" alt="" />
      </p>
    </div>
    <div>
      <p th:if="${stand_flag}">
        引く前の合計:[[${tmpdTotal}]]
      </p>
      <p th:unless="${stand_flag}">
        引く前の合計:?????
      </p>
    </div>
  </div>

  <div class="text-center" th:if="${AddDCards}">
    <div th:each="card2,stat:${AddDCards}">
      トランプの数字の合計が16以下なのでヒットします<br>
      <img height="100px" th:src="@{${'/tramp/' + card2.id + '.jpg'}}" alt="" />
    </div>
    トランプの数字の合計が17以上なのでスタンドします<br>
    スタンド後の合計:[[${dTotal}]]
  </div>

  <div class="largefont text-center" th:switch="${result}">
    <p th:case=1>
      Win!
    </p>
    <p th:case=-1>
      Lose
    </p>
    <p th:case=2>
      Draw
    </p>
    <!--p th:case=*>

    </p-->

  </div>
  <div class="text-center" th:if="${user}">
    ユーザー情報(仮設置)
    ID:[[${user.user_id}]]
    名前:"[[${user.username}]]"
    持ちチップ:[[${user.chip}]]<br>
  </div>

  <div class="text-center" th:unless="${bet}">
    チップを賭けてください(100チップまで可)
    <form th:action="@{/blackjack/{rid}/bet(rid=${room_id})}" method="post">
      <input type="number" name="bet" id="check" required>
      <input type="submit" value="ベット" onclick="betcontrol()"><input type="reset" value="リセット">
    </form>
  </div>
  <!-- JavaScriptを読み込む // -->
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="/blackjack.js"></script>
  <!-- // JavaScriptを読み込む  -->
</body>

</html>
